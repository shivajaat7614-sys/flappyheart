<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Flappy Heart ‚Äî Shiva & Anjuuu (Final Pro)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --sky1:#9bd8ff; --sky2:#77c8ff; --accent1:#ff6b8a; --accent2:#ff3b5e;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--sky1),var(--sky2));-webkit-font-smoothing:antialiased}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;box-sizing:border-box}
  .stage{width:min(760px,96vw);border-radius:18px;padding:18px;box-sizing:border-box;position:relative;overflow:hidden}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
  .title{font-weight:700;font-size:18px;color:#042a3a}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{border:0;padding:9px 12px;border-radius:10px;font-weight:700;cursor:pointer;transition:transform 160ms, box-shadow 160ms}
  .btn:active{transform:translateY(2px)}
  .playBtn{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white}
  .startBtn{background:linear-gradient(90deg,#6ad3ff,#4ab6ff);color:#003044}
  .mutebtn{background:transparent;border:1px solid rgba(0,0,0,0.06);color:#042a3a;padding:8px;border-radius:10px}
  .canvasWrap{position:relative;border-radius:14px;overflow:hidden;background:linear-gradient(180deg,var(--sky1),var(--sky2));padding:12px}
  canvas{display:block;width:100%;height:520px;border-radius:10px;background:transparent}
  .inforow{display:flex;align-items:center;justify-content:space-between;padding-top:10px;gap:8px}
  .score{font-weight:700;color:#042a3a}
  .hint{opacity:0.85;color:#042a3a}
  .footer{margin-top:12px;text-align:center;color:#023;opacity:0.9;font-size:13px}

  /* intro overlay */
  .introOverlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:50;background:linear-gradient(180deg, rgba(2,6,23,0.18), rgba(2,6,23,0.12));transition:opacity 420ms ease, transform 420ms ease}
  .introCard{width:min(680px,92%);max-width:640px;padding:22px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));backdrop-filter: blur(8px);box-shadow:0 18px 50px rgba(2,6,23,0.28);text-align:center;color:#012}
  .introTitle{font-size:20px;font-weight:800;margin-bottom:8px}
  .typeText{font-size:15px;min-height:56px;color:#012;opacity:0.95;white-space:pre-wrap}
  .startRow{display:flex;gap:12px;justify-content:center;margin-top:14px}
  .startCTA{padding:12px 18px;border-radius:12px;border:0;font-weight:800;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;cursor:pointer}
  .skipCTA{padding:10px 14px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:#012;cursor:pointer}

  @media (max-width:520px){ canvas{height:420px} .introCard{padding:16px} .introTitle{font-size:18px} }
</style>
</head>
<body>
<div class="wrap">
  <div class="stage">
    <div class="topbar">
      <div class="brand"><div class="logo">SH</div><div class="title">Flappy Heart</div></div>
      <div class="controls">
        <button id="playMusicBtn" class="btn playBtn">‚ñ∂Ô∏è PLAY MUSIC</button>
        <button id="startBtnTop" class="btn startBtn">START GAME</button>
        <button id="mute" class="btn mutebtn">üîä</button>
      </div>
    </div>

    <div class="canvasWrap">
      <canvas id="c"></canvas>

      <div class="introOverlay" id="introOverlay" aria-hidden="false">
        <div class="introCard">
          <div class="introTitle">WELCOME</div>
          <div class="typeText" id="typeText"></div>
          <div class="startRow">
            <button id="introStart" class="startCTA" disabled>Start Game</button>
            <button id="introSkip" class="skipCTA">Skip Intro</button>
          </div>
        </div>
      </div>

    </div>

    <div class="inforow">
      <div class="score" id="scoreLabel">Score: 0</div>
      <div class="hint">Tap / Space to flap üíó</div>
    </div>

    <div class="footer">Made by Shiva ‚ù§Ô∏è Anjuuu</div>
  </div>
</div>

<!-- Romantic soft background music (Pixabay) -->
<audio id="bgMusic" preload="auto" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/11/02/audio_1d1e709105.mp3?filename=romantic-soft-ambient.mp3" type="audio/mpeg">
</audio>

<script>
/* FINAL polished version:
   - SMALL heart (r=7)
   - heart glow + particles
   - music fade-in on start
   - robust unlock logic
   - smooth physics and UI polish
*/

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d', {alpha:true});
let DPR = window.devicePixelRatio || 1;

function resizeCanvas(){
  const maxW = Math.min(window.innerWidth - 48, 720);
  const h = Math.max(420, Math.min(window.innerHeight - 200, 720));
  canvas.style.width = maxW + 'px';
  canvas.style.height = h + 'px';
  canvas.width = Math.floor(maxW * DPR);
  canvas.height = Math.floor(h * DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

/* UI elements */
const introOverlay = document.getElementById('introOverlay');
const typeTextEl = document.getElementById('typeText');
const introStart = document.getElementById('introStart');
const introSkip = document.getElementById('introSkip');
const playMusicBtn = document.getElementById('playMusicBtn');
const startBtnTop = document.getElementById('startBtnTop');
const muteBtn = document.getElementById('mute');
const scoreLabel = document.getElementById('scoreLabel');
const bgMusic = document.getElementById('bgMusic');

/* Audio unlock + fade-in */
bgMusic.volume = 0.0;
let audioCtx = null;
let soundOn = true;

function getOrCreateAC(){
  try{
    const AC = window.AudioContext || window.webkitAudioContext;
    if(!AC) return null;
    if(!window.__ac) window.__ac = new AC();
    return window.__ac;
  }catch(e){ return null; }
}

async function tryStartBgMusic(){
  try{
    const ac = getOrCreateAC();
    if(ac && ac.state === 'suspended') await ac.resume();
    if(ac && !bgMusic._connected){
      try{ const src = ac.createMediaElementSource(bgMusic); src.connect(ac.destination); bgMusic._connected = true; }catch(e){}
    }
    await bgMusic.play();
    soundOn = true; muteBtn.textContent = 'üîä';
    return true;
  }catch(e){
    return false;
  }
}

async function fadeInMusic(){
  try{
    bgMusic.volume = 0;
    await tryStartBgMusic();
    let v = 0;
    const target = 0.28;
    const step = 0.03;
    const t = setInterval(()=>{
      v += step;
      if(v >= target){ v = target; clearInterval(t); }
      bgMusic.volume = v;
    }, 60);
  }catch(e){}
}

playMusicBtn.addEventListener('click', async ()=>{
  const ok = await tryStartBgMusic();
  if(ok){ playMusicBtn.textContent = '‚è∏ PAUSE MUSIC'; bgMusic.volume = 0.28; }
  else alert('If preview blocks audio, open this file in Chrome for full experience.');
});

muteBtn.addEventListener('click', ()=>{
  soundOn = !soundOn;
  if(soundOn){ fadeInMusic(); muteBtn.textContent = 'üîä'; }
  else { try{ bgMusic.pause(); }catch(e){} muteBtn.textContent = 'üîá'; }
});

const gestureUnlock = async ()=>{ await tryStartBgMusic(); window.removeEventListener('touchstart', gestureUnlock); window.removeEventListener('mousedown', gestureUnlock); };
window.addEventListener('touchstart', gestureUnlock, {passive:true});
window.addEventListener('mousedown', gestureUnlock, {once:true});

/* Game state */
let running = false, gameOver = false, frame = 0, pipes = [], score = 0, high = 0;
const gravity = 0.52, flapPower = -9.0;
let gapSize = 140, pipeSpeed = 2.6;

/* heart (SMALL) */
const heart = { x: 90, y: 200, r: 7, vy:0, angle:0, wob:0 };

/* particles */
const particles = [];
function createParticles(x,y,count=8){
  for(let i=0;i<count;i++){
    particles.push({
      x, y,
      vx: (Math.random()-0.5)*2.2,
      vy: -Math.random()*2.4 - 0.6,
      life: 0.8 + Math.random()*0.6,
      size: 3 + Math.random()*3,
      alpha: 1
    });
  }
}

/* beep */
function beep(freq=900,dur=0.04,vol=0.06){
  if(!soundOn) return;
  try{
    const ac = getOrCreateAC();
    if(!ac) return;
    const o = ac.createOscillator(); const g = ac.createGain();
    o.type = 'sine'; o.frequency.value = freq; g.gain.value = vol;
    o.connect(g); g.connect(ac.destination); o.start(); o.stop(ac.currentTime + dur);
  }catch(e){}
}

/* pipes */
function spawnPipe(){
  const H = canvas.height / DPR;
  const topMin = 50;
  const topMax = Math.max(110, H - gapSize - 80);
  const top = topMin + Math.floor(Math.random() * Math.max(1, topMax - topMin));
  pipes.push({ x: (canvas.width / DPR) + 80, top, w:56, passed:false });
}

/* reset */
function resetGame(){
  running = true; gameOver = false; pipes = []; frame = 0; score = 0; gapSize = 140;
  heart.x = 90; heart.y = (canvas.height / DPR) * 0.36; heart.vy = 0; heart.angle = 0;
  scoreLabel.textContent = 'Score: 0';
}

/* update */
function update(dt){
  if(!running) return;
  frame++;
  if(frame % 110 === 0) spawnPipe();

  heart.vy += gravity;
  heart.y += heart.vy;
  heart.wob += 0.12;
  heart.angle = Math.max(Math.min(heart.vy * 0.03, 0.8), -0.9);

  for(let p of pipes) p.x -= pipeSpeed;
  pipes = pipes.filter(p => p.x > -160);

  for(let p of pipes){
    if(!p.passed && p.x + p.w < heart.x){
      p.passed = true; score++; beep(780,0.03,0.05); scoreLabel.textContent = 'Score: ' + score;
      if(score > high) high = score;
      if(score % 6 === 0 && gapSize > 105) gapSize -= 6;
    }
  }

  const groundY = (canvas.height / DPR) - 6;
  if(heart.y + heart.r > groundY) endGame();
  if(heart.y - heart.r < 6){ heart.y = heart.r + 6; heart.vy = 0; }

  for(const p of pipes){
    const px = p.x, pw = p.w, pt = p.top, pb = pt + gapSize;
    if(heart.x + heart.r > px && heart.x - heart.r < px + pw){
      if(heart.y - heart.r < pt || heart.y + heart.r > pb) endGame();
    }
  }

  for(let i=particles.length-1;i>=0;i--){
    const s = particles[i];
    s.vy += 0.06;
    s.x += s.vx;
    s.y += s.vy;
    s.life -= 0.016;
    s.alpha = Math.max(0, s.life/1.4);
    if(s.life <= 0) particles.splice(i,1);
  }
}

/* draw */
function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }

function draw(){
  const W = canvas.width / DPR;
  const H = canvas.height / DPR;
  ctx.clearRect(0,0,canvas.width, canvas.height);

  // sky
  const bg = ctx.createLinearGradient(0,0,0,H);
  bg.addColorStop(0, '#9bd8ff'); bg.addColorStop(1, '#77c8ff');
  ctx.fillStyle = bg; ctx.fillRect(0,0,W,H);

  // soft bands for depth
  ctx.globalAlpha = 0.08;
  for(let i=0;i<5;i++){
    ctx.fillStyle = (i%2===0)? '#0b2b3b':'#08202d';
    const y = 30 + i*40 + Math.sin((frame + i*40)/40) * 6;
    ctx.fillRect(0, y, W, 12);
  }
  ctx.globalAlpha = 1;

  // clouds
  ctx.fillStyle = 'rgba(255,255,255,0.92)';
  const t = frame * 0.6;
  ctx.beginPath(); ctx.ellipse(W*0.22 + Math.sin(t/80)*18, H*0.18, 70,30,0,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.ellipse(W*0.7 + Math.cos(t/90)*28, H*0.12, 110,40,0,0,Math.PI*2); ctx.fill();

  // pipes
  for(const p of pipes){
    const x = p.x, top = p.top, bot = top + gapSize, pw = p.w;
    ctx.fillStyle = '#0d3b2e'; roundRect(ctx, x, 0, pw, top, 8); ctx.fill();
    roundRect(ctx, x, bot, pw, H - bot, 8); ctx.fill();
    ctx.fillStyle = '#0f6b4f'; roundRect(ctx, x - 6, top - 16, pw + 12, 16, 6); ctx.fill();
    roundRect(ctx, x - 6, bot, pw + 12, 16, 6); ctx.fill();
  }

  // ground
  ctx.fillStyle = '#065988'; ctx.fillRect(0, H - 6, W, 6);

  // heart glow
  ctx.save(); ctx.globalAlpha = 0.18; ctx.fillStyle = '#ff3b5e'; ctx.beginPath(); ctx.arc(heart.x, heart.y, heart.r * 3.2, 0, Math.PI*2); ctx.fill(); ctx.restore();

  // shadow
  ctx.save(); ctx.globalAlpha = 0.22; ctx.fillStyle = 'rgba(0,0,0,0.42)'; ctx.beginPath(); ctx.ellipse(heart.x, H - 6, 10, 3.5, 0, 0, Math.PI*2); ctx.fill(); ctx.restore();

  // heart gradient shape (scaled small)
  const g = ctx.createLinearGradient(heart.x - 8, heart.y - 8, heart.x + 8, heart.y + 8);
  g.addColorStop(0, '#ff89a8'); g.addColorStop(1, '#ff3b5e');
  ctx.fillStyle = g;
  ctx.save();
  ctx.translate(heart.x, heart.y);
  ctx.rotate(heart.angle + Math.sin(heart.wob) * 0.02);
  ctx.scale(heart.r / 20, heart.r / 20);
  ctx.beginPath();
  ctx.moveTo(0, -8);
  ctx.bezierCurveTo(8, -30, 50, -20, 50, 8);
  ctx.bezierCurveTo(50, 40, 20, 62, 0, 80);
  ctx.bezierCurveTo(-20, 62, -50, 40, -50, 8);
  ctx.bezierCurveTo(-50, -20, -8, -30, 0, -8);
  ctx.closePath();
  ctx.fill();
  ctx.restore();

  // particles
  for(const p of particles){
    ctx.globalAlpha = p.alpha;
    ctx.fillStyle = 'rgba(255,90,120,' + p.alpha + ')';
    ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
  }
  ctx.globalAlpha = 1;

  // HUD
  ctx.fillStyle = 'rgba(2,6,23,0.95)';
  ctx.font = '700 18px Inter, system-ui';
  ctx.textAlign = 'left'; ctx.fillText('Score: ' + score, 12, 28);
  ctx.textAlign = 'right'; ctx.fillText('High: ' + high, W - 12, 28);
}

/* loop */
let last = performance.now();
function loop(now){
  const dt = Math.min(40, now - last);
  last = now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* controls */
function flap(){
  if(gameOver) return;
  if(!running){ resetGame(); fadeInMusic(); }
  heart.vy = flapPower; heart.wob = 0; createParticles(heart.x, heart.y + 6, 10); beep(1200,0.03,0.05);
}

canvas.addEventListener('mousedown', ()=>{ flap(); });
canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); flap(); }, {passive:false});
window.addEventListener('keydown', (e)=>{ if(e.code === 'Space'){ e.preventDefault(); flap(); } });

/* start buttons */
introStart.addEventListener('click', ()=>{
  introStart.disabled = true; introSkip.disabled = true;
  introOverlay.style.opacity = 0; introOverlay.style.transform = 'translateY(-8px) scale(.995)';
  setTimeout(()=> introOverlay.style.display = 'none', 420);
  resetGame(); fadeInMusic();
});
introSkip.addEventListener('click', ()=>{
  if(typingInterval){ clearInterval(typingInterval); typingInterval = null; }
  typeTextEl.textContent = introString.replace(/\n/g,'\n');
  introStart.disabled = false;
});
startBtnTop.addEventListener('click', ()=>{
  if(introOverlay.style.display !== 'none'){ introOverlay.style.opacity = 0; setTimeout(()=>introOverlay.style.display='none',420); }
  resetGame(); fadeInMusic();
});

/* typing */
const introString = "WELCOME TO SHIVA ‚ù§Ô∏è ANJUU\nFLAPPY HEART";
let idx = 0, typingInterval = null;
function startTyping(){
  typeTextEl.textContent = '';
  typingInterval = setInterval(()=>{
    if(idx >= introString.length){ clearInterval(typingInterval); typingInterval = null; introStart.disabled = false;
      typeTextEl.innerHTML += '<span style="display:inline-block;width:8px;height:18px;background:linear-gradient(180deg,#fff,#ffd6de);border-radius:3px;animation:blink 900ms steps(1) infinite;margin-left:6px"></span>';
      return;
    }
    const ch = introString[idx++]; typeTextEl.textContent += ch;
  }, 36);
}
setTimeout(()=> startTyping(), 420);

/* endGame */
function endGame(){
  if(gameOver) return;
  gameOver = true; running = false;
  scoreLabel.textContent = 'Score: ' + score;
  introOverlay.style.display = 'flex'; introOverlay.style.opacity = 1; introOverlay.style.transform = 'translateY(0) scale(1)';
  typeTextEl.textContent = `Game Over\nScore: ${score}`;
  introStart.disabled = false;
  beep(220,0.26,0.14);
}

/* small initial pipes to look alive */
setTimeout(()=>{ spawnPipe(); spawnPipe(); }, 300);

/* console note */
console.log("If audio blocked in editor preview, open this file in Chrome (Open with ‚Üí Chrome).");

</script>
</body>
</html>
